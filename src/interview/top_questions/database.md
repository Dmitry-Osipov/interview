# Топ вопросов по базам данных
## Оглавление
- [Что такое реляционная база данных?](#что-такое-реляционная-база-данных)
- [Что такое первичный ключ?](#что-такое-первичный-ключ)
- [Что такое внешний ключ?](#что-такое-внешний-ключ)
- [Что такое нормализация?](#что-такое-нормализация)
- [Что такое денормализация?](#что-такое-денормализация)
- [Что такое транзакция?](#что-такое-транзакция)
- [Объясните свойства ACID](#объясните-свойства-acid)
- [Что такое JOIN? Какие типы соединений существуют?](#что-такое-join-какие-типы-соединений-существуют)
- [Что такое индекс?](#что-такое-индекс)
- [Что такое представление (VIEW)?](#что-такое-представление-view)
- [Что такое хранимая процедура?](#что-такое-хранимая-процедура)
- [Что такое триггер?](#что-такое-триггер)
- [Что такое кластеризация таблиц?](#что-такое-кластеризация-таблиц)
- [Что такое уникальный ключ (UNIQUE)?](#что-такое-уникальный-ключ-unique)
- [Что такое каскадное удаление (ON DELETE CASCADE)?](#что-такое-каскадное-удаление-on-delete-cascade)
- [Что такое GROUP BY?](#что-такое-group-by)
- [Чем отличаются WHERE и HAVING?](#чем-отличаются-where-и-having)
- [Что такое подзапрос (subquery) и когда его используют?](#что-такое-подзапрос-subquery-и-когда-его-используют)
- [Какие уровни изоляции существуют?](#какие-уровни-изоляции-существуют)
- [Что такое оптимистическая и пессимистическая блокировка?](#что-такое-оптимистическая-и-пессимистическая-блокировка)
- [Что такое CTE (Common Table Expression)?](#что-такое-cte-common-table-expression)
- [Что такое агрегация данных? Какие функции существуют?](#что-такое-агрегация-данных-какие-функции-существуют)
- [Что такое DISTINCT?](#что-такое-distinct)
- [Что такое UNION и чем он отличается от UNION ALL?](#что-такое-union-и-чем-он-отличается-от-union-all)
- [Чем отличается DELETE от TRUNCATE?](#чем-отличается-delete-от-truncate)
- [Что такое рефлективная целостность?](#что-такое-рефлективная-целостность)
- [Что такое партиционирование?](#что-такое-партиционирование)
- [Что такое шардирование?](#что-такое-шардирование)
- [Чем отличается база данных от схемы?](#чем-отличается-база-данных-от-схемы)
- [Что такое JSON и как с ним работать?](#что-такое-json-и-как-с-ним-работать)
- [Что такое аналитическая функция?](#что-такое-аналитическая-функция)
- [Что такое ROW_NUMBER()?](#что-такое-row_number)
- [Чем отличаются реляционные и нереляционные базы данных?](#чем-отличаются-реляционные-и-нереляционные-базы-данных)
- [Чем отличается COUNT(*) от COUNT(столбец)?](#чем-отличается-count-от-countстолбец)
- [Чем отличаются логическая и физическая структура базы данных?](#чем-отличаются-логическая-и-физическая-структура-базы-данных)
- [Что такое синтаксис DDL и DML?](#что-такое-синтаксис-ddl-и-dml)
- [Что такое кросс-таблица (pivot table)?](#что-такое-кросс-таблица-pivot-table)
## Что такое реляционная база данных?
Реляционная база данных (РБД) — это тип базы данных, в которой данные хранятся в виде таблиц (реляций). Таблицы состоят
из строк и столбцов. В реляционной модели данные организуются так, что между различными таблицами можно установить 
связи (отношения), что упрощает извлечение и управление данными.
## Что такое первичный ключ?
Первичный ключ (Primary Key) — это уникальный идентификатор строки в таблице. В таблице не может быть двух строк с
одинаковым первичным ключом. Поле, определённое как первичный ключ, не может содержать NULL значений.
## Что такое внешний ключ?
Внешний ключ (Foreign Key) — это поле в таблице, которое создаёт связь с первичным ключом другой таблицы. Внешние ключи
обеспечивают целостность данных, гарантируя, что значения в столбце существуют в связанном столбце другой таблицы.
## Что такое нормализация?
Нормализация — это процесс организации данных в базе данных с целью минимизации избыточности данных и обеспечения
целостности. Нормализация включает несколько нормальных форм (1NF, 2NF, 3NF и т.д.), каждая из которых имеет свои 
правила. [Подробнее про нормализацию](../database/core/normalization.md)
## Что такое денормализация?
Денормализация — это процесс преднамеренного добавления избыточности данных в базу данных для повышения
производительности. В некоторых случаях нормализованные данные могут требовать сложных операций соединения (JOIN),
которые могут замедлять выполнение запросов. Денормализация уменьшает такие соединения за счёт дублирования данных.
[Подробнее про денормализацию](../database/core/normalization.md)
## Что такое транзакция?
Транзакция — это последовательность операций с базой данных, которая выполняется как одно целое. Транзакция должна
обладать четырьмя основными свойствами (ACID): атомарностью, согласованностью, изолированностью и долговечностью.
[Подробнее про ACID](../database/core/acid.md)
## Объясните свойства ACID
ACID — это набор свойств, которые обеспечивают надежность транзакций в реляционных базах данных:
- Атомарность (Atomicity): Транзакция либо выполняется полностью, либо не выполняется вовсе.
- Согласованность (Consistency): После выполнения транзакции база данных должна оставаться в согласованном состоянии.
- Изолированность (Isolation): Параллельно выполняемые транзакции не должны мешать друг другу.
- Долговечность (Durability): После завершения транзакции её результаты должны быть сохранены, даже в случае сбоев
системы.

[Подробнее про ACID](../database/core/acid.md)
## Что такое JOIN? Какие типы соединений существуют?
JOIN используется для объединения строк из двух или более таблиц на основе связанного между ними условия. Существуют
несколько типов JOIN:
- INNER JOIN: Возвращает только те строки, которые имеют совпадение в обеих таблицах.
- LEFT JOIN: Возвращает все строки из левой таблицы, и совпадающие строки из правой таблицы (или NULL,
если совпадений нет).
- RIGHT JOIN: Возвращает все строки из правой таблицы, и совпадающие строки из левой таблицы.
- FULL OUTER JOIN: Возвращает строки, если есть совпадения в любой из таблиц, включая строки без совпадений.

[Подробнее про JOIN](../database/core/operators.md)
## Что такое индекс?
Индекс — это структура данных, используемая для ускорения операций поиска в таблице. Индексы позволяют быстрее находить
данные по определённым столбцам. [Подробнее про индексы](../database/core/indexes_in_postgres.md)
## Что такое представление (VIEW)?
Представление (View) — это виртуальная таблица, которая формируется на основе запроса. Представления не содержат 
данных, но облегчают доступ к сложным запросам.

Пример:
```sql
CREATE VIEW UserOrders AS
SELECT Users.Name, Orders.Product
FROM Users
JOIN Orders ON Users.ID = Orders.UserID;
```
Теперь вместо сложного запроса можно просто использовать:
```sql
SELECT * FROM UserOrders;
```
## Что такое хранимая процедура?
Хранимая процедура (Stored Procedure) — это заранее скомпилированный набор SQL-команд, который хранится в базе данных 
и может быть повторно вызван.

Пример:
```sql
CREATE PROCEDURE GetUserByID(@UserID INT)
AS
BEGIN
    SELECT * FROM Users WHERE ID = @UserID;
END;
```
Процедуру можно вызвать:
```sql
EXEC GetUserByID 1;
```
## Что такое триггер?
Триггер — это фрагмент кода, который автоматически выполняется при выполнении определённого события в базе данных,
например, вставки или обновления данных.
```sql
CREATE TRIGGER AfterInsertUser
ON Users
AFTER INSERT
AS
BEGIN
    PRINT 'Новый пользователь был добавлен';
END;
```
## Что такое кластеризация таблиц?
Кластеризация — это способ физического хранения данных, при котором строки разных таблиц, имеющих связь, сохраняются
вместе. Это повышает производительность JOIN-запросов.
## Что такое уникальный ключ (UNIQUE)?
Уникальный ключ (UNIQUE) — это ограничение, которое заставляет все значения в столбце (или группе столбцов) быть 
уникальными. Это значит, что два одинаковых значения в одном столбце не могут повторяться. Однако, в отличие от
первичного ключа, уникальный ключ допускает одно значение NULL.
```sql
CREATE TABLE Users (
    ID INT PRIMARY KEY,
    Email VARCHAR(100) UNIQUE
);
```
[Подробнее про UNIQUE](../database/core/operators.md)
## Что такое каскадное удаление (ON DELETE CASCADE)?
Каскадное удаление (ON DELETE CASCADE) — это поведение внешнего ключа, при котором при удалении записи в родительской
таблице автоматически удаляются все связанные записи в дочерней таблице.
```sql
CREATE TABLE Orders (
    OrderID INT PRIMARY KEY,
    UserID INT,
    FOREIGN KEY (UserID) REFERENCES Users(ID) ON DELETE CASCADE
);
```
## Что такое GROUP BY?
GROUP BY используется для группировки строк по значению одного или нескольких столбцов. Часто применяется в сочетании 
с агрегатными функциями (SUM, COUNT, AVG).
```sql
SELECT Product, COUNT(*) AS TotalOrders
FROM Orders
GROUP BY Product;
```
[Подробнее про GROUP BY](../database/core/operators.md)
## Чем отличаются WHERE и HAVING?
WHERE фильтрует строки до выполнения группировки, а HAVING фильтрует группы после выполнения группировки. То есть WHERE
используется с обычными строками данных, а HAVING — с агрегированными результатами.
```sql
SELECT Product, COUNT(*) AS TotalOrders
FROM Orders
WHERE Price > 100  -- фильтр по строкам
GROUP BY Product
HAVING COUNT(*) > 5;  -- фильтр по группам
```
[Подробнее про WHERE и HAVING](../database/core/operators.md)
## Что такое подзапрос (subquery) и когда его используют?
Подзапрос — это запрос, вложенный внутрь другого запроса. Он используется для получения данных, которые зависят от
выполнения другого запроса.
```sql
SELECT Name
FROM Users
WHERE ID IN (SELECT UserID FROM Orders WHERE Product = 'Laptop');
```
## Какие уровни изоляции существуют?
- Read Uncommitted: Транзакции могут видеть незавершённые изменения других транзакций (грязные чтения).
- Read Committed: Транзакции видят только завершённые изменения других транзакций.
- Repeatable Read: Гарантируется, что значения, считанные в рамках одной транзакции, не изменятся.
- Serializable: Самый высокий уровень изоляции, гарантирует отсутствие межтранзакционных конфликтов, но снижает
производительность.

[Подробнее про проблемы параллелизма](../database/core/multythreading.md)
## Что такое оптимистическая и пессимистическая блокировка?
- Пессимистическая блокировка подразумевает, что записи блокируются сразу при попытке чтения или изменения, чтобы 
предотвратить одновременный доступ других транзакций.
- Оптимистическая блокировка предполагает, что конфликты редки, и данные не блокируются, а проверяются перед
завершением транзакции на предмет изменений другими транзакциями.

[Подробнее про блокировки с Hibernate](../database/hibernate/locking.md)
## Что такое CTE (Common Table Expression)?
CTE — это временный результат, который может использоваться повторно в пределах одного запроса. Он создаётся с помощью
ключевого слова WITH.
```sql
WITH UserOrders AS (
    SELECT UserID, COUNT(*) AS OrderCount
    FROM Orders
    GROUP BY UserID
)
SELECT Users.Name, UserOrders.OrderCount
FROM Users
JOIN UserOrders ON Users.ID = UserOrders.UserID;
```
## Что такое агрегация данных? Какие функции существуют?
Агрегация данных — это процесс обобщения данных для получения сводных результатов. Основные агрегатные функции:
- COUNT() — возвращает количество строк.
- SUM() — возвращает сумму значений.
- AVG() — вычисляет среднее значение.
- MIN() и MAX() — возвращают минимальное и максимальное значения соответственно.

[Другие операторы](../database/core/operators.md)
## Что такое DISTINCT?
DISTINCT используется для удаления дубликатов из результатов запроса.
```sql
SELECT DISTINCT Product FROM Orders;
```
Этот запрос вернёт только уникальные продукты из таблицы заказов.
## Что такое UNION и чем он отличается от UNION ALL?
UNION объединяет результаты двух запросов, убирая дубликаты. UNION ALL объединяет результаты, включая дубликаты.
```sql
SELECT Name FROM Users
UNION
SELECT Name FROM Customers;
```
UNION удаляет повторяющиеся значения имен.
## Чем отличается DELETE от TRUNCATE?
- DELETE удаляет строки из таблицы по указанному условию, операция записывается в журнал транзакций.
- TRUNCATE удаляет все строки из таблицы без журналирования отдельных операций и быстрее, но не позволяет использовать
WHERE.
## Что такое рефлективная целостность?
Рефлективная целостность — это свойство базы данных, которое гарантирует, что ссылки между таблицами корректны. 
Например, если внешний ключ в одной таблице ссылается на другой объект, то этот объект должен существовать.
## Что такое партиционирование?
[Подробно про партиционирование](../database/optimization/partitioning.md)
## Что такое шардирование?
[Подробно про шардирование](../database/optimization/sharding.md)
## Чем отличается база данных от схемы?
База данных включает все объекты, такие как таблицы, индексы, процедуры и т.д. Схема — это набор объектов (таблиц и 
других объектов базы данных), принадлежащих одному пользователю.
## Что такое JSON и как с ним работать?
JSON (JavaScript Object Notation) — это формат хранения структурированных данных. Многие СУБД, такие как PostgreSQL и
MySQL, поддерживают хранение и обработку данных в формате JSON.
```sql
CREATE TABLE Products (
    ID INT PRIMARY KEY,
    Info JSON
);
```
## Что такое аналитическая функция?
Аналитические функции позволяют выполнять вычисления по нескольким строкам в рамках одной группы или набора строк. Они
часто используются с ключевым словом OVER.
```sql
SELECT Name, Salary, RANK() OVER (ORDER BY Salary DESC) AS SalaryRank
FROM Employees;
```
## Что такое ROW_NUMBER()?
ROW_NUMBER() — это функция, которая присваивает уникальный номер строкам в рамках результата запроса.
```sql
SELECT Name, ROW_NUMBER() OVER (ORDER BY Name) AS RowNum
FROM Users;
```
## Чем отличаются реляционные и нереляционные базы данных?
Реляционные базы данных используют таблицы и поддерживают связи между таблицами. Нереляционные базы данных (NoSQL)
работают с неструктурированными или слабо структурированными данными (например, JSON, графовые данные). Реляционные
базы более строгие, а нереляционные предлагают гибкость для масштабирования.
## Чем отличается COUNT(*) от COUNT(столбец)?
- COUNT(*) подсчитывает все строки, включая строки с NULL значениями.
- COUNT(столбец) подсчитывает только строки, где столбец имеет непустые значения.
## Чем отличаются логическая и физическая структура базы данных?
- Логическая структура включает схемы, таблицы, представления и т.д.
- Физическая структура связана с фактическим хранением данных на диске, например, файлы данных, индексы.
## Что такое синтаксис DDL и DML?
- DDL (Data Definition Language): команды для определения структуры данных, например, CREATE, ALTER, DROP.
- DML (Data Manipulation Language): команды для управления данными, например, SELECT, INSERT, UPDATE, DELETE.
## Что такое кросс-таблица (pivot table)?
Кросс-таблица — это таблица, которая преобразует строки в столбцы для представления сводной информации. Это часто
используется для аналитической обработки данных.
