# ACID
## Оглавление
- [Определение](#определение)
- [Atomicity (Атомарность)](#atomicity-атомарность)
- [Consistency (Согласованность)](#consistency-согласованность)
- [Isolation (Изолированность)](#isolation-изолированность)
- [Durability (Надёжность)](#durability-надёжность)
## Определение
ACID — это набор свойств, которые гарантируют надежность и корректность транзакций в системах управления базами данных. 
Аббревиатура ACID расшифровывается как Atomicity (Атомарность), Consistency (Согласованность), Isolation
(Изолированность) и Durability (Надёжность).
## Atomicity (Атомарность)
Атомарность означает, что транзакция рассматривается как единое целое: она либо выполняется полностью, либо не 
выполняется вовсе. Если в ходе выполнения транзакции происходит ошибка, все изменения, сделанные в рамках этой 
транзакции, должны быть отменены, и система возвращается к исходному состоянию.

Пример:

Предположим, у нас есть банковская система, в которой пользователь переводит деньги со своего счета на другой. 
Транзакция включает два шага:
1) Списание денег с одного счета.
2) Зачисление денег на другой счет.

Если первый шаг выполнится, но второй не удастся из-за сбоя, система должна отменить списание, чтобы не возникло 
ситуации, когда деньги исчезли с одного счета, но не появились на другом.
```sql
BEGIN TRANSACTION;

UPDATE accounts SET balance = balance - 100 WHERE account_id = 1; -- списание денег
-- Представим, что здесь произошла ошибка, и следующий запрос не сработал
UPDATE accounts SET balance = balance + 100 WHERE account_id = 2; -- зачисление денег

IF (ошибка) THEN
    ROLLBACK; -- отмена транзакции
ELSE
    COMMIT; -- фиксация транзакции
END IF;
```
## Consistency (Согласованность)
Согласованность означает, что любая транзакция переводит базу данных из одного согласованного состояния в другое. Это 
гарантирует, что после завершения транзакции все ограничения базы данных (такие как целостность данных) будут соблюдены.

Пример:

Предположим, что в банковской системе существует правило: баланс счета не может быть отрицательным. Если транзакция
попытается списать сумму, превышающую текущий баланс счета, она должна быть отклонена, чтобы сохранить согласованность
данных.
```sql
BEGIN TRANSACTION;

-- Проверяем, достаточно ли денег на счете
IF (SELECT balance FROM accounts WHERE account_id = 1) >= 100 THEN
    UPDATE accounts SET balance = balance - 100 WHERE account_id = 1; -- списание
    UPDATE accounts SET balance = balance + 100 WHERE account_id = 2; -- зачисление
    COMMIT; -- фиксация транзакции
ELSE
    ROLLBACK; -- отмена транзакции
END IF;
```
## Isolation (Изолированность)
Изолированность гарантирует, что параллельно выполняющиеся транзакции не будут вмешиваться друг в друга. Каждая 
транзакция должна видеть базу данных так, как если бы она была единственной выполняемой в данный момент.

Пример:

Допустим, два пользователя одновременно переводят деньги с одного и того же счета. Если транзакции не изолированы, 
возможно, что обе транзакции увидят один и тот же начальный баланс и обе попытаются списать деньги, что приведет к
неправильным расчетам. Изолированность предотвращает такие ситуации, гарантируя, что одна транзакция не увидит 
изменения, внесенные другой, пока та не завершится.
```sql
-- Транзакция 1
BEGIN TRANSACTION;

UPDATE accounts SET balance = balance - 100 WHERE account_id = 1; -- списание

-- Транзакция 2 (началась параллельно с Транзакцией 1)
BEGIN TRANSACTION;

-- Транзакция 2 будет ждать завершения Транзакции 1 перед выполнением своего UPDATE
UPDATE accounts SET balance = balance - 50 WHERE account_id = 1; -- списание

COMMIT; -- фиксация Транзакции 1
COMMIT; -- фиксация Транзакции 2
```
## Durability (Надёжность)
Надёжность означает, что после фиксации транзакции (commit), ее результаты будут сохранены в базе данных, даже если
произойдет сбой системы. Это свойство гарантирует, что данные не будут потеряны после успешного выполнения транзакции.

Пример:

Предположим, что транзакция завершилась успешно, деньги были переведены, и система зафиксировала изменения. Даже если 
сразу после этого произойдет сбой (например, отключение питания), при восстановлении системы эти изменения будут
сохранены.
```sql
BEGIN TRANSACTION;

UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;
UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;

COMMIT; -- фиксация транзакции, данные гарантированно сохранены
```
