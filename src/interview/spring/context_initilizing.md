# Этапы инициализации контекста
## Оглавление
- [Этапы](#этапы)
- [1 этап. Парсирование конфигурации](#1-этап-парсирование-конфигурации)
- [2 этап. Настройка созданных BeanDefinition](#2-этап-настройка-созданных-beandefinition)
- [3 этап. Создание кастомных FactoryBean](#3-этап-создание-кастомных-factorybean)
- [4 этап. Создание экземпляров бинов](#4-этап-создание-экземпляров-бинов)
- [5 этап. Настройка созданных бинов](#5-этап-настройка-созданных-бинов)
## Этапы
1) Парсирование конфигурации (XML, Groovy, JavaConfig и др.) и создание всех BeanDefinition 
(AnnotatedBeanDefinitionReader, BeanDefinitionReader, ClassPathBeanDefinitionScanner)
2) Настройка созданных BeanDefinition (BeanFactoryPostProcessor)
3) Создание кастомных FactoryBean (FactoryBean<T>)
4) BeanFactory создаёт экземпляры бинов, при необходимости делегируя создание бина FactoryBean (BeanFactory)
5) Настройка созданных бинов (BeanPostProcessor)
## 1 этап. Парсирование конфигурации
Цель первого этапа - это создание всех Bean Definition. Bean Definition - это специальный интерфейс, через который можно 
получить доступ к метаданным будущего бина. В зависимости от того, какая у вас конфигурация, будет использоваться тот 
или иной механизм парсирования конфигурации
## 2 этап. Настройка созданных BeanDefinition
После первого этапа у нас имеется Map, в котором хранятся BeanDefinition. Архитектура спринга построена таким образом, 
что у нас есть возможность повлиять на то, какими будут наши бины ещё до их фактического создания, иначе говоря мы имеем 
доступ к метаданным класса. Для этого существует специальный интерфейс BeanFactoryPostProcessor, реализовав который, 
мы получаем доступ к созданным BeanDefinition и можем их изменять. В этом интерфейсе всего один метод:
```java
public interface BeanFactoryProcessor {
    void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException;
}
```
Метод postProcessBeanFactory принимает параметром ConfigurableListableBeanFactory. Данная фабрика содержит много 
полезных методов, в том числе getBeanDefinitionNames, через который мы можем получить все BeanDefinitionNames, а уже 
потом по конкретному имени получить BeanDefinition для дальнейшей обработки метаданных.
## 3 этап. Создание кастомных factoryBean
FactoryBean - это generic интерфейс, которому можно делегировать процесс создания бинов типа.
## 4 этап. Создание экземпляров бинов
Созданием экземпляров бинов занимается BeanFactory при этом, если нужно, делегирует это кастомным FactoryBean. 
Экземпляры бинов создаются на основе ранее созданных BeanDefinition.
## 5 этап. Настройка созданных бинов
Интерфейс BeanPostProcessor позволяет вклиниться в процесс настройки ваших бинов до того, как они попадут в контейнер. 
Интерфейс несёт в себе несколько методов:
```java
public interface BeanPostProcessor {
    Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException;
    Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException;
}
```
Оба метода вызываются для каждого бина. Оба метода имеют абсолютно одинаковые параметры. Разница только в порядке их 
вызова. Первый вызывается до init-метода, а второй после. Важно понимать, что на данном этапе экземпляр бина уже создан 
и идёт его донастройка. Тут есть 2 важных момента:
1) Оба метода в итоге должны вернуть бин. Если в методе вы вернёте null, то при получении этого бина из контекста вы 
получите null, а поскольку через BeanPostProcessor проходят все бины после поднятия контекста, при запросе любого бина
вы будете получать null.
2) Если вы хотите сделать прокси над объектом, то это принято делать после вызова init-метода, иначе говоря, это нужно 
делать в методе postProcessAfterInitialization.
