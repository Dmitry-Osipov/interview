# @Transactional
## Оглавление
- [Определение](#определение)
- [Как работает под капотом](#как-работает-под-капотом)
- [Основные аспекты](#основные-аспекты)
- [propagation - Уровень распространения транзакций](#propagation---уровень-распространения-транзакции)
- [isolation - Уровень изоляции транзакции](#isolation---уровень-изоляции-транзакции)
- [timeout - Время выполнения транзакции](#timeout---время-выполнения-транзакции)
- [readOnly - Транзакция только для чтения](#readonly---транзакция-только-для-чтения)
- [rollbackFor и RollbackForClassName - Откат транзакции для указанных исключений](#rollbackfor-и-rollbackforclassname---откат-транзакции-для-указанных-исключений)
- [noRollbackFor и noRollbackForClassName - Исключения, при которых транзакция не будет откатываться](#norollbackfor-и-norollbackforclassname---исключения-при-которых-транзакция-не-будет-откатываться)
## Определение
Аннотация @Transactional в Java используется для управления транзакциями в приложениях, построенных с использованием 
фреймворка Spring. Она позволяет декларативно управлять транзакциями, делая код проще и более гибким. Когда метод 
помечен аннотацией @Transactional, Spring автоматически обрабатывает транзакции для этого метода в соответствии с 
заданными параметрами.
## Как работает под капотом
Spring использует аспектно-ориентированное программирование (AOP) для реализации поведения аннотации @Transactional. 
Когда вы вызываете метод, помеченный @Transactional, Spring создает прокси-объект, который управляет транзакцией: 
открывает её при входе в метод и завершает при выходе (фиксацией или откатом в зависимости от результата).
## Основные аспекты
- propagation: Определяет, как должна быть обработана существующая транзакция при вызове метода (например, 
создавать новую, использовать существующую или игнорировать).
- isolation: Указывает уровень изоляции транзакции, определяя, как различные транзакции могут влиять друг на друга.
- timeout: Определяет максимальное время выполнения транзакции. Если транзакция занимает больше времени, чем указано, 
она будет прервана.
- readOnly: Указывает, что транзакция предназначена только для чтения. Это может помочь в оптимизации, так как 
СУБД может обрабатывать такие транзакции более эффективно.
- rollbackFor и noRollbackFor: Определяют типы исключений, при которых транзакция будет откатана или, наоборот, 
не откатана.
## propagation - Уровень распространения транзакции
Этот параметр определяет, как должна вести себя транзакция, когда текущий метод вызывает другой метод, который также 
помечен @Transactional. Существует несколько режимов распространения:
- REQUIRED (по умолчанию): Если уже существует активная транзакция, текущий метод будет выполнен в ее рамках. 
Если транзакции нет, будет создана новая.
- REQUIRES_NEW: Всегда создается новая транзакция. Если уже существует активная транзакция, она приостанавливается до 
завершения новой.
- SUPPORTS: Если существует активная транзакция, метод будет выполнен в ее рамках. Если нет, метод выполнится 
без транзакции.
- NOT_SUPPORTED: Метод всегда выполняется вне транзакции. Если существует активная транзакция, она приостанавливается 
на время выполнения метода.
- MANDATORY: Метод должен быть выполнен в рамках существующей транзакции. Если транзакции нет, выбрасывается исключение.
- NEVER: Метод не должен выполняться в рамках транзакции. Если существует активная транзакция, выбрасывается исключение.
- NESTED: Если существует активная транзакция, создается новая вложенная транзакция. Если транзакции нет, создается 
новая. Вложенные транзакции поддерживаются не всеми СУБД.
## isolation - Уровень изоляции транзакции
Этот параметр определяет, насколько изменения, внесенные одной транзакцией, видимы другим параллельно выполняющимся 
транзакциям. Уровни изоляции направлены на решение проблем, связанных с 
[параллельными транзакциями](../database/core/multythreading.md), таких как "грязное чтение", "фантомное чтение" и т.д. 
Основные уровни изоляции:
- DEFAULT (по умолчанию): Используется уровень изоляции, установленный по умолчанию в СУБД.
- READ_UNCOMMITTED: Наиболее низкий уровень изоляции. Транзакция может видеть изменения, внесенные другими транзакциями,
даже если они еще не были зафиксированы (commit). Это может привести к "грязному чтению".
- READ_COMMITTED: Транзакция может видеть только те изменения, которые были зафиксированы другими транзакциями. Это
предотвращает "грязное чтение", но не защищает от "неповторяющегося чтения".
- REPEATABLE_READ: Гарантирует, что данные, прочитанные одной транзакцией, не будут изменены другими транзакциями до
завершения первой транзакции. Это предотвращает "грязное" и "неповторяющееся чтение", но не защищает от 
"фантомных чтений".
- SERIALIZABLE: Самый высокий уровень изоляции, предотвращающий все типы аномалий, но с высокой стоимостью
производительности. Каждая транзакция выполняется последовательно.
## timeout - Время выполнения транзакции
Этот параметр определяет максимальное время (в секундах), которое может занять выполнение транзакции. Если транзакция
не завершается в течение этого времени, она будет автоматически прервана и откатана.
## readOnly - Транзакция только для чтения
Этот параметр указывает, что транзакция предназначена только для чтения. Это может позволить СУБД оптимизировать 
выполнение запросов, так как СУБД знает, что в рамках этой транзакции данные изменяться не будут.
## rollbackFor и RollbackForClassName - Откат транзакции для указанных исключений
Эти параметры определяют, для каких исключений транзакция должна быть откатана. Вы можете указать класс исключения
или его имя в виде строки.
- rollbackFor: Указывает один или несколько классов исключений, для которых транзакция должна быть откатана.
- rollbackForClassName: Указывает один или несколько классов исключений по их имени (строкой), для которых транзакция 
должна быть откатана.
## noRollbackFor и noRollbackForClassName - Исключения, при которых транзакция не будет откатываться
Эти параметры противоположны rollbackFor. Они определяют, для каких исключений транзакция не должна быть откатана, 
даже если они возникли.
- noRollbackFor: Указывает один или несколько классов исключений, для которых транзакция не будет откатываться.
- noRollbackForClassName: Указывает один или несколько классов исключений по их имени, для которых транзакция не будет
откатываться.
